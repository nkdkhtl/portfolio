name: Auto update repo metadata

on:
  push:
    branches: [main]

permissions:
  contents: write
  metadata: write

jobs:
  update-about:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const languages = await github.rest.repos.listLanguages({
              owner: context.repo.owner,
              repo: context.repo.repo
            });

            const langs = Object.keys(languages.data);
            if (langs.length === 0) return;

            const mainLang = langs[0];

            const topicsMap = {
              JavaScript: ['javascript', 'frontend', 'web'],
              TypeScript: ['typescript', 'frontend'],
              Java: ['java', 'backend'],
              Python: ['python', 'automation']
            };

            const topics = topicsMap[mainLang] || [mainLang.toLowerCase()];

            await github.rest.repos.update({
              owner: context.repo.owner,
              repo: context.repo.repo,
              description: `Project written mainly in ${mainLang}`,
              topics: topics
            });
